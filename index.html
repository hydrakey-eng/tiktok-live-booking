<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TikTok Live Booking System</title>
    <link rel="stylesheet" href="style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Remix Icon -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
</head>

<body>
    <!-- LOGIN SCREEN -->
    <div id="login-screen" class="login-container">
        <div class="login-box">
            <div class="logo-large">
                <i class="ri-live-line"></i>
                <span>LiveBook</span>
            </div>
            <h2>Welcome Back</h2>
            <p>Sign in to access the booking portal</p>
            <form id="loginForm">
                <div class="form-group">
                    <label>Username</label>
                    <input type="text" id="loginUsername" placeholder="Enter username" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter password" required>
                </div>
                <button type="submit" class="btn-primary">Sign In</button>
            </form>
            <p class="login-footer">Default Admin: <strong>admin</strong> / <strong>admin123</strong></p>
        </div>
    </div>

    <!-- MAIN APP (Hidden until login) -->
    <div id="app-main" class="app-container" style="display: none;">
        <aside class="sidebar">
            <div class="logo">
                <i class="ri-live-line"></i>
                <span>LiveBook</span>
            </div>

            <nav class="nav-menu" id="navMenu">
                <!-- Populated by JS based on Role -->
            </nav>

            <div class="user-profile">
                <div class="avatar" id="currentUserAvatar">U</div>
                <div class="user-info">
                    <p class="name" id="currentUserName">User</p>
                    <p class="role" id="currentUserRole">Role</p>
                </div>
                <button onclick="logout()" class="btn-logout" title="Logout"><i
                        class="ri-logout-box-r-line"></i></button>
            </div>
        </aside>

        <main class="main-content">
            <!-- STAFF VIEW -->
            <section id="staff-view" class="view-section active">
                <header class="section-header">
                    <h1>Book a Session</h1>
                    <p>Schedule your next TikTok Live performance.</p>
                </header>

                <div class="content-grid">
                    <div class="card booking-form-card">
                        <h2>New Booking</h2>
                        <form id="bookingForm">
                            <div class="form-group">
                                <label>Studio Room</label>
                                <select id="bookingRoom" required>
                                    <option value="Main Studio">Main Studio (Standard)</option>
                                    <option value="Gaming Room">Gaming Room (RGB Setup)</option>
                                    <option value="Lounge">Just Chatting Lounge</option>
                                    <option value="Green Screen">Green Screen Studio</option>
                                </select>
                            </div>
                            <!-- CALENDAR COMPONENT -->
                            <div class="form-group">
                                <label>Select Date</label>
                                <div id="calendar-component" class="calendar-wrapper">
                                    <!-- Calendar Header -->
                                    <div class="calendar-header">
                                        <button type="button" id="prevMonthBtn"><i
                                                class="ri-arrow-left-s-line"></i></button>
                                        <span id="currentMonthLabel">Month Year</span>
                                        <button type="button" id="nextMonthBtn"><i
                                                class="ri-arrow-right-s-line"></i></button>
                                    </div>
                                    <!-- Days Grid -->
                                    <div class="calendar-grid" id="calendarDays">
                                        <!-- JS will populate this -->
                                    </div>
                                </div>
                                <input type="hidden" id="bookingDate" required>
                            </div>

                            <div class="form-group" id="timeSlotGroup" style="display:none;">
                                <label>Available Time Slots</label>
                                <div id="time-slots-container" class="time-slot-chips">
                                    <!-- JS will populate this -->
                                </div>
                                <input type="hidden" id="bookingTime" required>
                            </div>
                            <div class="form-group">
                                <label>Stream Title / Topic</label>
                                <input type="text" id="bookingTitle" placeholder="e.g. Summer Sale Special" required>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="ri-calendar-check-line"></i>
                                Request Booking
                            </button>
                        </form>
                    </div>

                    <div class="card my-bookings-card">
                        <h2>My Bookings</h2>
                        <div class="bookings-list" id="staffBookingsList">
                            <!-- Populated by JS -->
                            <div class="empty-state">
                                <p>Loading bookings...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- MANAGER VIEW -->
            <section id="manager-view" class="view-section" style="display: none;">
                <header class="section-header">
                    <h1>Manager Dashboard</h1>
                    <p>Review requests and monitor schedule.</p>
                    <button id="exportExcelBtn" class="btn-primary"
                        style="margin-top: 10px; background-color: #10b981;">
                        <i class="ri-file-excel-2-line"></i> Export Data
                    </button>
                </header>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="icon-box info"><i class="ri-time-line"></i></div>
                        <div class="stat-info">
                            <h3>Pending</h3>
                            <span id="statPending">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-box success"><i class="ri-check-double-line"></i></div>
                        <div class="stat-info">
                            <h3>Approved</h3>
                            <span id="statApproved">0</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="icon-box warning"><i class="ri-money-dollar-circle-line"></i></div>
                        <div class="stat-info">
                            <h3>Total Sales</h3>
                            <span id="statSales">$0</span>
                        </div>
                    </div>
                </div>

                <!-- NEW: Analytics Chart Section -->
                <div class="card chart-card" style="margin-bottom: 2rem;">
                    <h2>Sales Analytics (Last 7 Days)</h2>
                    <div style="height: 300px;">
                        <canvas id="salesChart"></canvas>
                    </div>
                </div>

                <div class="content-grid">
                    <div class="card requests-card">
                        <h2>Pending Requests</h2>
                        <div class="requests-list" id="pendingRequestsList">
                            <!-- Populated by JS -->
                            <div class="empty-state">
                                <p>No pending requests.</p>
                            </div>
                        </div>
                    </div>

                    <div class="card calendar-card">
                        <h2>Approved Schedule</h2>
                        <div class="calendar-list" id="approvedCalendarList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </section>

            <!-- TEAM MANAGEMENT VIEW (New for v3) -->
            <section id="team-view" class="view-section" style="display: none;">
                <header class="section-header">
                    <h1>Team Management</h1>
                    <p>Manage staff members and access.</p>
                </header>

                <div class="content-grid">
                    <div class="card booking-form-card"> <!-- Reuse form card style -->
                        <h2>Add New Member</h2>
                        <form id="addUserForm">
                            <div class="form-group">
                                <label>Full Name</label>
                                <input type="text" id="newUserName" placeholder="e.g. John Doe" required>
                            </div>
                            <div class="form-group">
                                <label>Username (Login)</label>
                                <input type="text" id="newUserUsername" placeholder="e.g. john.d" required>
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="newUserPassword" placeholder="******" required>
                            </div>
                            <div class="form-group">
                                <label>Role</label>
                                <select id="newUserRole">
                                    <option value="staff">Staff Member</option>
                                    <option value="manager">Manager</option>
                                </select>
                            </div>
                            <button type="submit" class="btn-primary">
                                <i class="ri-user-add-line"></i>
                                Create Account
                            </button>
                        </form>
                    </div>

                    <div class="card">
                        <h2>Employee Performance Summary (This Month)</h2>
                        <div id="employeeSummaryList">
                            <!-- JS Rendered -->
                        </div>
                    </div>

                    <div class="card">
                        <h2>Team Members</h2>
                        <div class="bookings-list" id="teamList">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal for Post-Stream Report -->
    <div id="reportModal" class="modal hidden">
        <div class="modal-content">
            <span class="close-modal" onclick="closeReportModal()">&times;</span>
            <h2>Post-Stream Report</h2>
            <form id="reportForm">
                <input type="hidden" id="reportBookingId">
                <div class="form-group">
                    <label>Actual Viewers</label>
                    <input type="number" id="actualViewers" placeholder="e.g. 1500" required>
                </div>
                <div class="form-group">
                    <label>Sales Amount ($)</label>
                    <input type="number" step="0.01" id="salesAmount" placeholder="e.g. 250.50" required>
                </div>
                <div class="form-group">
                    <label>Duration (Hours)</label>
                    <input type="number" step="0.1" id="reportDuration" placeholder="e.g. 2.5" required>
                </div>
                <button type="submit" class="btn-primary">Submit Report</button>
            </form>
        </div>
    </div>

    <!-- LIBRARIES -->
    <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- SheetJS for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <!-- Firebase SDK (Version 9+ Modular) -->
    <!-- Using Compat version for simpler simple script tag usage without bundler complexity if preferred, 
         but here we use the specific modular imports via ES modules in script.js OR unified compat for ease -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <script src="script.js"></script>
</body>

</html>